$(function() {
	/*------------------Sliders-------------------*/

	$('.offer__slider').slick({
		infinite: true,
		arrows: true,
		slidesToShow: 1,
		adaptiveHeight: false,
		edgeFriction: 0.25,
	});

	$('.news__slider').slick({
		infinite: false,
		arrows: true,
		speed: 300,
		slidesToShow: 1,
		variableWidth: true,
		nextArrow: '<button type="button" class="common-arrow common-next"></button>',
		prevArrow: '<button type="button" class="common-arrow common-prev"></button>',
		responsive: [
	{
		breakpoint: 544,
		settings: {
			variableWidth: false
		}
	}
		]
	});
	$('.cases__slider').slick({
		infinite: true,
		arrows: true,
		speed: 300,
		slidesToShow: 2,
		nextArrow: '<button type="button" class="common-arrow common-next"></button>',
		prevArrow: '<button type="button" class="common-arrow common-prev"></button>',
		responsive: [
	{
		breakpoint: 710,
		settings: {
			slidesToShow: 1
		}
	},
	{
		breakpoint: 992,
		settings: {
			slidesToShow: 2
		}
	},
	{
		breakpoint: 1100,
		settings: {
			slidesToShow: 3
		}
	}
		]
	});

	$('.team__slider').slick({
		infinite: true,
		arrows: true,
		speed: 300,
		slidesToShow: 3,
		nextArrow: '<button type="button" class="common-arrow common-next"></button>',
		prevArrow: '<button type="button" class="common-arrow common-prev"></button>',
		responsive: [
	{
		breakpoint: 769,
			settings: {
				slidesToShow: 1,
				centerPadding: '0px',
				centerMode: false,
				focusOnSelect: false
			}
	},
	{
		breakpoint: 870,
			settings: {
				slidesToShow: 1,
				centerPadding: '210px',
				centerMode: true,
				focusOnSelect: true
			}
	},
	{
		breakpoint: 1101,
		settings: {
			slidesToShow: 1,
			centerPadding: '270px',
			centerMode: true,
			focusOnSelect: true
		}
	},
	{
		breakpoint: 1271,
		settings: {
			slidesToShow: 1,
			centerPadding: '350px',
			centerMode: true,
			focusOnSelect: true
		}
	}
		]
	});


	/*-----------------------Selectize---------------------*/

	$('select.log__select').selectize();

	/*-------------------Autosize textarea-------------------*/
	autosize(document.querySelectorAll('textarea'));

	/*-----------------------Plus/minus amount---------------*/
	$('.minus').click(function () {
		var $input = $(this).parent().find('input');
		var count = parseInt($input.val()) - 1;
		count = count < 1 ? 1 : count;
		$input.val(count);
		$input.change();
		return false;
	});
	$('.plus').click(function () {
		var $input = $(this).parent().find('input');
		$input.val(parseInt($input.val()) + 1);
		$input.change();
		return false;
	});

	/*----------------Video in first screen----------------*/
	$('.popup-youtube').magnificPopup({ 
		type: 'iframe',
		removalDelay: 300,
		mainClass: 'my-mfp-zoom-in' 
	});

	/*-----------------Modal-------------------------*/
	$('.popup-link-1, .popup-link-2').magnificPopup({
		type: 'inline',
		mainClass: 'my-mfp-zoom-in',
		showCloseBtn: true,
		closeBtnInside: true
	});

	/*---------------------Tabs-------------------------*/
	$('ul.tabs__caption').on('click', 'li:not(.active)', function() {
		$(this).addClass('active').siblings().removeClass('active').closest('.tabs').find('div.tabs__content').removeClass('active').eq($(this).index()).addClass('active');
  });

	/*---------------------Show password----------------*/
	$('.password-eye').click(function(){
		var e = $(this).toggleClass('pass-hidden'),
		traget = e.data('target');
		if(traget && $(traget).length)
		$(traget).prop('type', (e.hasClass('pass-hidden')? 'text':'password'));
	});


	/*---------------------Sort menu------------------*/
	 function getUrlVars() {
	 	var vars = {};
	 	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
            vars[key] = value;
	 	});
	 	return vars;
	 }


	 if($('.sort-menu').length){
	 	var sorting = getUrlVars()["orderby"];
	 	var order_text = 'по популярности';

	 	if(sorting == 'rating') {
	 		order_text = 'по рейтингу';
	 	} else if(sorting == 'date') {
	 		order_text = 'по новизне';
	 	} else if(sorting == 'price') {
	 		order_text = 'цены: по возростанию';
	 	} else if(sorting == 'price-desc') {
	 		order_text = 'цены: по убыванию';
	 	}
	 	$('#parametr').text(order_text).data('value',sorting);
	 }


	$('.sort-menu li').on('click',function() {

			$('#parametr').html($(this).find('a').html());
			window.location = 'http://wayup/shop/?orderby=' + $(this).find('a').data('value');
		});

	/*-----------------------List-grid-------------------------*/
	$('#on-list').on('click', function() {
		$(this).addClass('make-list');
		$('#on-grid').removeClass('make-grid');
		$('#products').fadeOut(300, function() {
			$(this).addClass('list').fadeIn(300);
		});
	});

	$('#on-grid').on('click', function() {
		$(this).addClass('make-grid');
		$('#on-list').removeClass('make-list');
		$('#products').fadeOut(300, function() {
			$(this).removeClass('list').fadeIn(300);
		});
	});

	/*----------------Categoties accordeon----------------*/
	$('#st-accordion').accordion({
		oneOpenedItem: true
	});

	/*------------------Progress bars---------------------*/

	// Remove svg.radial-progress .complete inline styling
	$('svg.radial-progress').each(function( index, value ) { 
			$(this).find($('circle.complete')).removeAttr( 'style' );
	});

	// Activate progress animation on scroll
	$(window).scroll(function(){
		$('svg.radial-progress').each(function( index, value ) { 
			// Get percentage of progress
			percent = $(value).data('percentage');
			$(this).find($('text.percentage')).html(percent + '%');
			// If svg.radial-progress is approximately 25% vertically into the window when scrolling from the top or the bottom
			if ( 
					$(window).scrollTop() > $(this).offset().top - ($(window).height() * 0.75) &&
					$(window).scrollTop() < $(this).offset().top + $(this).height() - ($(window).height() * 0.25)
			) {
				
				// Get radius of the svg's circle.complete
				radius = $(this).find($('circle.complete')).attr('r');
				// Get circumference (2πr)
				circumference = 2 * Math.PI * radius;
				// Get stroke-dashoffset value based on the percentage of the circumference
				strokeDashOffset = circumference - ((percent * circumference) / 100);
				// Transition progress for 1.25 seconds
				$(this).find($('circle.complete')).animate({'stroke-dashoffset': strokeDashOffset}, 1250);
			}
		});
	}).trigger('scroll');

	/*-------------------Hide long text----------------------*/

	$('.is-home .clients__text').dotdotdot();

	$('.inner.clients .clients__text').each(function(){
		var $dot5 = $(this);
			$dot5.append( ' <a class="clients__more link-more" href="#"><span class="open">Читать далее</span><span class="close">Свернуть</span></a>' );
			$dot5.find('.clients__more').append( ' <svg class="arrow" width="18" height="20"><use xlink:href="#nav-right"/></svg> ' );


			function createDots()
			{
				$dot5.dotdotdot({
					after: 'a.clients__more',
					watch: 'window'
				});
			}
			function destroyDots() {
				$dot5.trigger( 'destroy' );
			}
			createDots();

			$dot5.on(
				'click',
				'a.clients__more',
				function() {
					$dot5.toggleClass( 'opened' );

					if ( $dot5.hasClass( 'opened' ) ) {
						destroyDots();
					} else {
						createDots();
					}
					return false;
				}
			);
	});

});


/*---------------More sliders--------------------*/
$(function(){
	$('.product__slider').slick({
		infinite: false,
		vertical: true,
		slidesToShow: 4,
		slidesToScroll: 1,
		verticalSwiping: true,
		lazyLoad: "ondemand",
		arrows: false,
		dotss: false,
		swipe: true,
		responsive: [
			{
				breakpoint: 1270,
					settings: {
						slidesToShow: 3
					}
			},
			{
				breakpoint: 992,
					settings: {
						slidesToShow: 4,
						vertical: false,
						verticalSwiping: false
					}
			},
			{
				breakpoint: 768,
					settings: {
						slidesToShow: 3,
						vertical: false,
						verticalSwiping: false
					}
			}
		]
	});
	$(".product__pic").on("click", function(e) {
		var t = $(this).parent().attr("data-slick-index");
		$(".product__img").attr({
			src: $(this).attr("src"),
			"data-index": t
		})
	});

	$('.сlients__slider').slick({
		adaptiveHeight: true,
		centerMode: true,
		slidesToShow: 1,
		slidesToScroll: 1,
		adaptiveHeight: false,
		centerPadding: '230px',
		infinite: true,
		arrows: false,
		focusOnSelect: true,
		edgeFriction: 0.5,
		responsive: [
			{
				breakpoint: 1560,
					settings: {
						centerPadding: '270px'
					}
			},
			{
				breakpoint: 1380,
					settings: {
						centerPadding: '225px'
					}
			},
			{
				breakpoint: 1180,
					settings: {
						centerPadding: '160px'
					}
			},
			{
				breakpoint: 993,
					settings: {
						adaptiveHeight: true,
						arrows: true,
						centerPadding: '0px',
						centerMode: false,
						nextArrow: '<button type="button" class="common-arrow common-next"></button>',
						prevArrow: '<button type="button" class="common-arrow common-prev"></button>'
					}
			}
		]
	});

});

/*--------------Form handler----------------*/

$(document).ready(function(){


	$('[data-submit]').on('click', function(e){
		e.preventDefault();
		$(this).parents('.subscribe__form, .inner__form, .cabinet__form, .review-form, .subscr__form, .order-form, .callme-form').submit();
	})
	$.validator.addMethod(
		"regex",
		function(value, element, regexp) {
			var re = new RegExp(regexp);
			return this.optional(element) || re.test(value);
		},
			"Please check your input."
	);
	function valEl(el){

		el.validate({
			rules:{
				tel:{ /*Проверка по данным атрибута name*/
					required:true,
					regex: '^([\+]+)*[0-9\x20\x28\x29\-]{11,20}$'
				},
				name:{
					required:true
				},
				email:{
					required:true,
					email:true
				},
				password:{
					required:true
				},
				learn:{
					required:true
				},
				tel1:{
					required:false,
					regex: '^([\+]+)*[0-9\x20\x28\x29\-]{11,20}$'
				},
				name1:{
					required:false
				},
				email1:{
					required:false,
					email:true
				},
				password1:{
					required:false
				}
			},
			messages:{
				tel:{
					required:'Поле обязательно для заполнения',
					regex:'Телефон может содержать символы + - ()'
				},
				name:{
					required:'Поле обязательно для заполнения',
				},
				password:{
					required:'Поле обязательно для заполнения',
				},
				learn:{
					required:'! Необходимо ознакомиться с правилами',
				},
				email:{
					required:'Поле обязательно для заполнения', 
					email:'Неверный формат Email'
				},
				tel1:{
					required:'Поле обязательно для заполнения',
					regex:'Телефон может содержать символы + - ()'
				},
				email1:{
					required:'Поле обязательно для заполнения', 
					email:'Неверный формат Email'
				}
			},

		submitHandler: function (form) {
			$('#form-loader').fadeIn();// Здесь меняем появление лоадера на необходимые действия
			var $form = $(form);
			var $formId = $(form).attr('id');

			switch($formId){

				case'popupOrder':
					$.ajax({
					type: 'POST',
					url: $form.attr('action'),
					data: $form.serialize(),
					})
				.always(function (response) {
					setTimeout(function (){
						$('#form-loader').fadeOut();
					},1000);
					setTimeout(function (){
						 $.magnificPopup.open({
							items: {
								src: '#taken'
							}
						});
						$form.trigger('reset');
						$('input').removeClass('valid');
						//строки для остлеживания целей в Я.Метрике и Google Analytics
					},1100);
					setTimeout(function (){
						$.magnificPopup.close();
					},4000);
				});
				break;

				case'displayMessage':
					$.ajax({
					type: 'POST',
					url: $form.attr('action'),
					data: $form.serialize(),
					})
				.always(function (response) {
					setTimeout(function (){
						$('#form-loader').fadeOut();
					},1000);
					setTimeout(function (){
						$('.edit>.modal-сaution').fadeIn();
						$form.trigger('reset');
						$('input').removeClass('valid');
						//строки для остлеживания целей в Я.Метрике и Google Analytics
					},1100);
					setTimeout(function (){
						$('.edit>.modal-сaution').fadeOut();
					},4000);
				});
				break;

				case'popupMessage':
					$.ajax({
					type: 'POST',
					url: $form.attr('action'),
					data: $form.serialize(),
					})
				.always(function (response) {
					setTimeout(function (){
						$('#form-loader').fadeOut();
					},1000);
					setTimeout(function (){
						 $.magnificPopup.open({
							items: {
								src: '#callback'
							}
						});
						$form.trigger('reset');
						$('input, textarea').removeClass('valid');
						//строки для остлеживания целей в Я.Метрике и Google Analytics
					},1100);
					setTimeout(function (){
						$.magnificPopup.close();
					},4000);
				});
				break;

				case'popupSubscribe':
					$.ajax({
					type: 'POST',
					url: $form.attr('action'),
					data: $form.serialize(),
					})
				.always(function (response) {
					setTimeout(function (){
						$('#form-loader').fadeOut();
					},1000);
					setTimeout(function (){
						 $.magnificPopup.open({
							items: {
								src: '#sub'
							}
						});
						$form.trigger('reset');
						$('input').removeClass('valid');
						//строки для остлеживания целей в Я.Метрике и Google Analytics
					},1100);
					setTimeout(function (){
						$.magnificPopup.close();
					},4000);
				});
				break;

			}
			return false; 
		}
	})
}

	$('form.subscribe__form, .inner__form, .cabinet__form, .review-form, .subscr__form, .order-form, .callme-form').each(function() {
		valEl($(this)); 
	});
});

/*---------------Validation forms in modals----------------*/

$(document).ready(function(){


	$('[data-submit]').on('click', function(e){
		e.preventDefault();
		$(this).parents('#log, #recover, #regist').submit();
	})
	$.validator.addMethod(
		"regex",
		function(value, element, regexp) {
			var re = new RegExp(regexp);
			return this.optional(element) || re.test(value);
		},
			"Please check your input."
	);
	function valEl(el){

		el.validate({
			rules:{
				tel_mod:{ /*Проверка по данным атрибута name*/
					required:true,
					regex: '^([\+]+)*[0-9\x20\x28\x29\-]{11,20}$'
				},
				name_mod:{
					required:true
				},
				email_mod:{
					required:true,
					email:true
				},
				password_mod:{
					required:true
				},
				confirm:{
					required:true
				}
			},
			messages:{
				tel_mod:{
					required:'Поле обязательно для заполнения',
					regex:'Телефон может содержать символы + - ()'
				},
				name_mod:{
					required:'Поле обязательно для заполнения',
				},
				password_mod:{
					required:'Поле обязательно для заполнения',
				},
				confirm:{
					required:'Поле обязательно для заполнения',
				},
				email_mod:{
					required:'Поле обязательно для заполнения', 
					email:'Неверный формат Email'
				}
			},

	})
}

	$('#log, #recover, #regist').each(function() {
		valEl($(this)); 
	});
});

/*-------------Validation form order registration---------------*/

$(document).ready(function(){

	$('[data-submit]').on('click', function(e){
		e.preventDefault();
		$(this).parents('#pay-form').submit();
	})
	$.validator.addMethod(
		"regex",
		function(value, element, regexp) {
			var re = new RegExp(regexp);
			return this.optional(element) || re.test(value);
		},
			"Please check your input."
	);
	function valEl(el){

		el.validate({
			rules:{
				tel:{ /*Проверка по данным атрибута name*/
					required:true,
					regex: '^([\+]+)*[0-9\x20\x28\x29\-]{11,20}$'
				},
				name:{
					required:true
				},
				lastname:{
					required:true
				},
				address:{
					required:true
				},
				city:{
					required:true
				},
				state:{
					required:true
				},
				zip:{
					required:true,
					regex: '^([\+]+)*[0-9\x20\x28\x29\-]{4,20}$'
				},
				email:{
					required:true,
					email:true
				},
				learn:{
					required:true
				},
			},
			messages:{
				tel:{
					required:'Поле обязательно для заполнения',
					regex:'Телефон может содержать символы + - ()'
				},
				name:{
					required:'Поле обязательно для заполнения'
				},
				lastname:{
					required:'Поле обязательно для заполнения'
				},
				address:{
					required:'Поле обязательно для заполнения'
				},
				city:{
					required:'Поле обязательно для заполнения'
				},
				state:{
					required:'Поле обязательно для заполнения'
				},
				zip:{
					required:'Поле обязательно для заполнения',
					regex:'Почтовый индекс может содержать цифры 0-9'
				},
				learn:{
					required:'! Необходимо ознакомиться с условиями'
				},
				email:{
					required:'Поле обязательно для заполнения', 
					email:'Неверный формат Email'
				}
			}
	})
}

	$('#pay-form').each(function() {
		valEl($(this)); 
	});
});
